workload: Transaction
operation: complex-read
number: 8
title: Transfer trace after loan applied
description: |
  Given a *Loan* and a specified time window between *start_time* and
  *end_time*, trace the fund *transfer* or *withdraw* by at most 3 steps
  from the *account* the *Loan* *deposits*. Note that the transfer paths of
  *edge1*, *edge2*, *edge3* and *edge4* are in a specific time range between
  *start_time* and *end_time*. Amount of each transfers or withdrawals between
  the account and the upstream account should exceed a specified *ratio* of the
  upstream transfer. Return all the amount ratio (*ratio1*, *ratio2*, and
  *ratio3*) groupby the *accounts*'s id at each step in descending order.
parameters:
  - name: id
    type: ID
    description: id of the Loan
  - name: ratio
    type: 32-bit Float
    description: ratio of the amount over the upstream's
  - name: start_time
    type: DateTime
    description: begin of the time window
  - name: end_time
    type: DateTime
    description: end of the time window
result:
  - name: ratio1
    type: 32-bit float
  - name: ratio2
    type: 32-bit float
  - name: ratio3
    type: 32-bit float
sort:
  - name: ratio1
    direction: desc
  - name: ratio2
    direction: desc
  - name: ratio3
    direction: desc
choke_points: []
relevance: |
  This query is a typical main fund trace case after loan granted in risk
  control.
