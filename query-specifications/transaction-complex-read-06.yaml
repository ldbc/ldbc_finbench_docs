workload: Transaction
operation: complex-read
number: 6
title: Withdrawal after Many-to-One transfer
description: |
  Given an *account* of type card and a specified time window between
  *start_time* and *end_time*, find all the connected *accounts*(*mid*) via
  withdrawal(*edge2*) satisfying,
  * More than 3 *transfer-ins*(*edge1*) from other *accounts*(*mid*) whose
  amount exceeds *threshold1*.
  * The amount of *withdrawal*(*edge2*) exceeds *threshold2*.
  Return the sum of transfer amount from *src* to *mid*, the amount from *mid*
  to *dstCard* groupby *mid*.
parameters:
  - name: id
    type: ID
    description: id of the card account
  - name: threshold1
    type: 64-bit Integer
    description: threshold of transfer amount
  - name: threshold2
    type: 64-bit Integer
    description: threshold of transfer amount
  - name: start_time
    type: DateTime
    description: begin of the time window
  - name: end_time
    type: DateTime
    description: end of the time window
result:
  - name: SUM(edge1.amount)
    type: 64-bit Integer
    description: the amount of withdrawal
    category: aggregated
  - name: SUM(edge2.amount)
    type: 64-bit Integer
    description: the amount of withdrawal
    category: aggregated
groupby: mid
sort:
  - name: SUM(edge2.amount)
    direction: desc
    description: the amount of withdrawal
choke_points: [3.2, 3.4, 6.2, 8.7]
relevance: |
  This query is a typical fund withdrawal after pooling funds case in risk control.
